<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inbox - Roomio</title>
    
    <link href="https:
    <link rel="stylesheet" href="https:
    <link rel="stylesheet" href="styles/site.css">
    <link rel="stylesheet" href="styles/inbox.css">
</head>
<body>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="p-4">
            <div class="d-flex align-items-center">
                <i class="bi bi-building text-primary fs-2 me-2"></i>
                <h4 class="mb-0 text-primary">Roomio</h4>
            </div>
        </div>
        
        <nav class="px-3">
            <a href="index.html" class="nav-link-custom">
                <i class="bi bi-house-door"></i>
                Beranda
            </a>
            <a href="search.html" class="nav-link-custom">
                <i class="bi bi-search"></i>
                Cari Kos
            </a>
            <a href="inbox.html" class="nav-link-custom active">
                <i class="bi bi-chat-dots"></i>
                Pesan
            </a>
            <a href="user-dashboard.html" class="nav-link-custom">
                <i class="bi bi-heart"></i>
                Favorit & Booking
            </a>
            
            <div id="hostNavLinks" class="d-none">
                <div class="pt-3 pb-2 px-3 text-muted small">PEMILIK</div>
                <a href="host-dashboard.html" class="nav-link-custom">
                    <i class="bi bi-building"></i>
                    Dashboard Host
                </a>
                <a href="create-listing.html" class="nav-link-custom">
                    <i class="bi bi-plus-circle"></i>
                    Tambah Listing
                </a>
            </div>
        </nav>
        
        <div class="position-absolute bottom-0 start-0 end-0 p-3 border-top">
            <a href="profile.html" class="nav-link-custom mb-2">
                <i class="bi bi-person"></i>
                <span id="userName">User</span>
            </a>
            <button class="btn btn-outline-secondary w-100" onclick="logout()">Keluar</button>
        </div>
    </aside>
    
    <main class="main-content">
        <div class="mobile-header">
            <button class="btn btn-link text-dark" onclick="toggleSidebar()">
                <i class="bi bi-list fs-4"></i>
            </button>
            <div class="d-flex align-items-center mx-auto">
                <i class="bi bi-building text-primary fs-5 me-2"></i>
                <h5 class="mb-0 text-primary">Roomio</h5>
            </div>
            <div style="width: 40px;"></div>
        </div>
        
        <div class="row g-0">
            <!-- Conversation List -->
            <div class="col-md-4 col-lg-3">
                <div class="conversation-list">
                    <div class="p-3 border-bottom">
                        <h5 class="mb-0">Pesan</h5>
                    </div>
                    <div id="conversationList">
                        <!-- Conversations will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Chat Area -->
            <div class="col-md-8 col-lg-9">
                <div id="chatArea" class="d-none">
                    <div class="chat-container">
                        <!-- Chat Header -->
                        <div class="p-3 border-bottom bg-white">
                            <div class="d-flex align-items-center">
                                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" 
                                     style="width: 48px; height: 48px;">
                                    <span id="chatUserInitial">I</span>
                                </div>
                                <div>
                                    <h6 class="mb-0" id="chatUserName">Ibu Siti</h6>
                                    <small class="text-muted">Online</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Messages -->
                        <div class="chat-messages" id="chatMessages">
                            <!-- Messages will be loaded here -->
                        </div>
                        
                        <!-- Input -->
                        <div class="chat-input">
                            <div class="input-group">
                                <input type="text" class="form-control" id="messageInput" placeholder="Ketik pesan...">
                                <button class="btn btn-primary" onclick="sendMessage()">
                                    <i class="bi bi-send"></i> Kirim
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="noChat" class="d-flex align-items-center justify-content-center h-100">
                    <div class="text-center">
                        <i class="bi bi-chat-dots fs-1 text-muted mb-3"></i>
                        <h5 class="text-muted">Pilih percakapan untuk mulai chat</h5>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <script src="https:
    <script src="js/auth.js"></script>
    <script src="js/listings.js"></script>
    <script>
        if (!requireAuth()) {

        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('show');
            overlay.classList.toggle('show');
        }
        
        document.getElementById('sidebarOverlay').addEventListener('click', toggleSidebar);
        

        const conversations = [
            {
                id: '1',
                user: 'Ibu Siti',
                lastMessage: 'Baik, silakan datang besok untuk survey',
                time: '10 menit yang lalu',
                unread: 1,
                messages: [
                    { sender: 'received', text: 'Halo, ada yang bisa saya bantu?', time: '10:00' },
                    { sender: 'sent', text: 'Selamat pagi, saya tertarik dengan kos Anda', time: '10:05' },
                    { sender: 'received', text: 'Baik, silakan datang besok untuk survey', time: '10:10' }
                ]
            },
            {
                id: '2',
                user: 'Pak Budi',
                lastMessage: 'Terima kasih atas infonya',
                time: '1 jam yang lalu',
                unread: 0,
                messages: [
                    { sender: 'received', text: 'Ada kamar yang masih tersedia?', time: '09:00' },
                    { sender: 'sent', text: 'Masih ada 2 kamar tersedia', time: '09:15' },
                    { sender: 'received', text: 'Terima kasih atas infonya', time: '09:20' }
                ]
            }
        ];
        
        let currentConversation = null;
        
        function loadConversations() {
            const container = document.getElementById('conversationList');
            
            container.innerHTML = conversations.map(conv => `
                <div class="conversation-item ${conv.id === '1' ? 'active' : ''}" onclick="openChat('${conv.id}')">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <strong>${conv.user}</strong>
                        <small class="text-muted">${conv.time}</small>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <p class="text-muted small mb-0 text-truncate" style="max-width: 200px;">${conv.lastMessage}</p>
                        ${conv.unread > 0 ? `<span class="badge bg-primary rounded-pill">${conv.unread}</span>` : ''}
                    </div>
                </div>
            `).join('');
            

            if (conversations.length > 0) {
                openChat('1');
            }
        }
        
        function openChat(id) {
            currentConversation = conversations.find(c => c.id === id);
            
            if (!currentConversation) return;
            

            document.getElementById('noChat').classList.add('d-none');
            document.getElementById('chatArea').classList.remove('d-none');
            

            document.querySelectorAll('.conversation-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            

            document.getElementById('chatUserName').textContent = currentConversation.user;
            document.getElementById('chatUserInitial').textContent = currentConversation.user.charAt(0);
            

            loadMessages();
        }
        
        function loadMessages() {
            const container = document.getElementById('chatMessages');
            
            container.innerHTML = currentConversation.messages.map(msg => `
                <div class="message ${msg.sender}">
                    ${msg.sender === 'received' ? `
                        <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" 
                             style="width: 40px; height: 40px; min-width: 40px;">
                            <span>${currentConversation.user.charAt(0)}</span>
                        </div>
                    ` : ''}
                    <div>
                        <div class="message-content">
                            <p class="mb-1">${msg.text}</p>
                            <small class="opacity-75">${msg.time}</small>
                        </div>
                    </div>
                </div>
            `).join('');
            

            container.scrollTop = container.scrollHeight;
        }
        
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !currentConversation) return;
            

            currentConversation.messages.push({
                sender: 'sent',
                text: text,
                time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })
            });
            

            currentConversation.lastMessage = text;
            currentConversation.time = 'Baru saja';
            

            input.value = '';
            

            loadMessages();
            

            setTimeout(() => {
                currentConversation.messages.push({
                    sender: 'received',
                    text: 'Terima kasih atas pesannya. Saya akan segera merespons.',
                    time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })
                });
                loadMessages();
            }, 2000);
        }
        

        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            updateAuthUI();
            loadConversations();
        });
    </script>
</body>
</html>