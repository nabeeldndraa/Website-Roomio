<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Roomio</title>
    
    <link href="https:
    <link rel="stylesheet" href="https:
    <link rel="stylesheet" href="styles/site.css">
    <link rel="stylesheet" href="styles/admin-dashboard.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="p-4 border-bottom">
            <div class="d-flex align-items-center">
                <i class="bi bi-shield-check text-danger fs-2 me-2"></i>
                <div>
                    <h5 class="mb-0 text-danger">Admin Panel</h5>
                    <small class="text-muted">Roomio</small>
                </div>
            </div>
        </div>

        <!-- Transactions placeholder (moved to main content so it shows) -->
        
        <nav class="px-3 py-3">
            <a href="#dashboard" class="nav-link active mb-2" onclick="showSection('dashboard', event)">
                <i class="bi bi-speedometer2 me-2"></i>
                Dashboard
            </a>
            <a href="#pending" class="nav-link mb-2" onclick="showSection('pending', event)">
                <i class="bi bi-clock-history me-2"></i>
                Listing Pending
                <span class="badge bg-warning ms-auto" id="pendingCount">0</span>
            </a>
            <a href="#listings" class="nav-link mb-2" onclick="showSection('listings', event)">
                <i class="bi bi-building me-2"></i>
                Semua Listing
            </a>
            <a href="#users" class="nav-link mb-2" onclick="showSection('users', event)">
                <i class="bi bi-people me-2"></i>
                Pengguna
            </a>
            <a href="#transactions" class="nav-link mb-2" onclick="showSection('transactions', event)">
                <i class="bi bi-receipt me-2"></i>
                Transaksi
                <span class="badge bg-info ms-auto" id="txnPendingCount">0</span>
            </a>
        </nav>
        
        <div class="position-absolute bottom-0 start-0 end-0 p-3 border-top">
            <a href="index.html" class="btn btn-outline-secondary w-100 mb-2">
                <i class="bi bi-arrow-left me-2"></i>
                Ke Website
            </a>
            <button class="btn btn-danger w-100" onclick="logout()">
                <i class="bi bi-box-arrow-right me-2"></i>
                Keluar
            </button>
        </div>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
        <!-- Mobile Header -->
        <div class="d-lg-none bg-white border-bottom p-3">
            <div class="d-flex align-items-center justify-content-between">
                <button class="btn btn-link" aria-label="Toggle navigation" onclick="toggleSidebar()">
                    <i class="bi bi-list fs-4"></i>
                </button>
                <h5 class="mb-0">Admin Panel</h5>
                <div class="mobile-spacer"></div>
            </div>
        </div>
        
        <!-- Dashboard Section -->
        <div id="dashboardSection" class="section-content">
            <div class="p-4">
                <h2 class="mb-4">Dashboard Admin</h2>
                
                <!-- Stats Cards -->
                <div class="row g-4 mb-5">
                    <div class="col-md-3">
                        <div class="stat-card bg-primary bg-gradient text-white p-4">
                            <div class="d-flex align-items-center justify-content-between">
                                <div>
                                    <div class="text-white-50 small mb-1">Total Pengguna</div>
                                    <h3 class="mb-0" id="statUsers">0</h3>
                                </div>
                                <i class="bi bi-people fs-1 opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="stat-card bg-warning bg-gradient text-white p-4">
                            <div class="d-flex align-items-center justify-content-between">
                                <div>
                                    <div class="text-white-50 small mb-1">Pending</div>
                                    <h3 class="mb-0" id="statPending">0</h3>
                                </div>
                                <i class="bi bi-clock-history fs-1 opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="stat-card bg-success bg-gradient text-white p-4">
                            <div class="d-flex align-items-center justify-content-between">
                                <div>
                                    <div class="text-white-50 small mb-1">Disetujui</div>
                                    <h3 class="mb-0" id="statApproved">0</h3>
                                </div>
                                <i class="bi bi-check-circle fs-1 opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="stat-card bg-danger bg-gradient text-white p-4">
                            <div class="d-flex align-items-center justify-content-between">
                                <div>
                                    <div class="text-white-50 small mb-1">Ditolak</div>
                                    <h3 class="mb-0" id="statRejected">0</h3>
                                </div>
                                <i class="bi bi-x-circle fs-1 opacity-50"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="card">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">Aktivitas Terbaru</h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Fitur aktivitas akan segera ditambahkan</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pending Listings Section -->
        <div id="pendingSection" class="section-content d-none">
            <div class="p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="mb-0">Listing Pending</h2>
                    <button class="btn btn-outline-secondary" onclick="loadPendingListings()">
                        <i class="bi bi-arrow-clockwise me-2"></i>
                        Refresh
                    </button>
                </div>
                
                <div id="pendingListingsContainer">
                    <!-- Pending listings will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- All Listings Section -->
        <div id="listingsSection" class="section-content d-none">
            <div class="p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="mb-0">Semua Listing</h2>
                    <div class="btn-group">
                        <button class="btn btn-outline-secondary" onclick="filterListings('')">Semua</button>
                        <button class="btn btn-outline-warning" onclick="filterListings('pending')">Pending</button>
                        <button class="btn btn-outline-success" onclick="filterListings('approved')">Disetujui</button>
                        <button class="btn btn-outline-danger" onclick="filterListings('rejected')">Ditolak</button>
                    </div>
                </div>
                
                <div id="allListingsContainer">
                    <!-- All listings will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Users Section -->
        <div id="usersSection" class="section-content d-none">
            <div class="p-4">
                <h2 class="mb-4">Manajemen Pengguna</h2>
                
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover" id="usersTable">
                                <thead>
                                    <tr>
                                        <th>Nama</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Bergabung</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- Users will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions Section (moved from sidebar so it appears in main content) -->
        <div id="transactionsSection" class="section-content d-none">
            <div class="p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="mb-0">Transaksi</h2>
                    <div>
                        <button class="btn btn-outline-secondary me-2" onclick="loadTransactions()">
                            <i class="bi bi-arrow-clockwise me-2"></i>
                            Refresh
                        </button>
                        <button class="btn btn-outline-primary" onclick="openFeeSettings()">
                            <i class="bi bi-gear me-1"></i>
                            Pengaturan Fee
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover" id="transactionsTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Penyewa</th>
                                        <th>Pemilik</th>
                                        <th>Listing</th>
                                        <th>Jumlah</th>
                                        <th>Fee Admin</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsTableBody">
                                    <!-- Transactions will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Approval Modal -->
    <div class="modal fade" id="approvalModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Konfirmasi Persetujuan</h5>
                    <button type="button" class="btn-close" aria-label="Close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Apakah Anda yakin ingin menyetujui listing ini?</p>
                    <p class="text-muted small">Listing akan langsung muncul di pencarian setelah disetujui.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-success" onclick="confirmApprove()">
                        <i class="bi bi-check-circle me-2"></i>
                        Setujui
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Rejection Modal -->
    <div class="modal fade" id="rejectionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tolak Listing</h5>
                    <button type="button" class="btn-close" aria-label="Close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Alasan Penolakan *</label>
                        <textarea class="form-control" id="rejectionReason" rows="4" 
                                  placeholder="Masukkan alasan penolakan yang jelas..."></textarea>
                    </div>
                    <p class="text-muted small">
                        <i class="bi bi-info-circle me-1"></i>
                        Alasan akan dikirim ke pemilik listing melalui notifikasi.
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" onclick="confirmReject()">
                        <i class="bi bi-x-circle me-2"></i>
                        Tolak Listing
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Badge Modal -->
    <div class="modal fade" id="badgeModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambahkan Badge pada Listing</h5>
                    <button type="button" class="btn-close" aria-label="Close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Pilih badge untuk listing ini</p>
                    <select id="badgeSelect" class="form-select mb-3" aria-label="Pilih badge untuk listing">
                        <option value="">-- Pilih badge --</option>
                        <option value="featured">Featured</option>
                        <option value="verified_host">Verified Host</option>
                        <option value="top_rated">Top Rated</option>
                    </select>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="1" id="badgeHighlight" checked>
                        <label class="form-check-label" for="badgeHighlight">Tandai sebagai highlight</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" onclick="assignBadge()">Simpan Badge</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Fee Modal -->
    <div class="modal fade" id="feeModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Atur Fee Admin</h5>
                    <button type="button" class="btn-close" aria-label="Close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <label class="form-label">Persentase Fee Admin (%)</label>
                    <input type="number" id="adminFeeInput" class="form-control mb-2" placeholder="Contoh 5 untuk 5%">
                    <small class="text-muted d-block mb-2">Atur fee yang akan dipotong dari setiap transaksi.</small>
                    <label class="form-label">Fee untuk listing saat ini (Rp)</label>
                    <input type="number" id="listingFeeInput" class="form-control" placeholder="Masukkan fee tetap untuk listing ini (opsional)">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" onclick="saveFeeSettings()">Simpan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Verify Modal -->
    <div class="modal fade" id="txnVerifyModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Verifikasi Transaksi</h5>
                    <button type="button" class="btn-close" aria-label="Close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="txnVerifyBody">Memuat...</p>
                    <div class="mb-3">
                        <label class="form-label">Status</label>
                        <select id="txnStatusSelect" class="form-select" aria-label="Pilih status transaksi">
                            <option value="pending">Pending</option>
                            <option value="verified">Terverifikasi</option>
                            <option value="refunded">Refunded</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-success" onclick="confirmVerifyTransaction()">Simpan Status</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https:
    <script src="js/auth.js"></script>
    <script src="js/notifications.js"></script>
    
    <script>
        let currentListingId = null;
        let approvalModal, rejectionModal, badgeModal, feeModal, txnVerifyModal;
        let currentTxnId = null;


        let adminFeePercent = 5;
        const listingBadges = {};
        const listingFees = {};

        const mockTransactions = [
            { id: 'T-3001', renter: 'Sari', owner: 'Agus', listing: 'Kos Modern 101', amount: 1500000, fee: 75000, status: 'pending' },
            { id: 'T-3002', renter: 'Rian', owner: 'Ika', listing: 'Apartemen A', amount: 3000000, fee: 150000, status: 'verified' }
        ];
        

        const user = getCurrentUser();
        if (!user || user.role !== 'admin') {
            notify.error('Anda harus login sebagai admin untuk mengakses halaman ini', 'Akses Ditolak');
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 2000);
        }
        

        document.addEventListener('DOMContentLoaded', function() {
            approvalModal = new bootstrap.Modal(document.getElementById('approvalModal'));
            rejectionModal = new bootstrap.Modal(document.getElementById('rejectionModal'));
            badgeModal = new bootstrap.Modal(document.getElementById('badgeModal'));
            feeModal = new bootstrap.Modal(document.getElementById('feeModal'));
            txnVerifyModal = new bootstrap.Modal(document.getElementById('txnVerifyModal'));

            loadDashboardStats();
            loadPendingListings();
            loadTransactions();
        });
        
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('show');
        }
        
        function showSection(section, evt) {

            document.querySelectorAll('.section-content').forEach(s => s.classList.add('d-none'));
            

            document.getElementById(section + 'Section').classList.remove('d-none');
            

            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));

            try {
                const usedEvent = evt || window.event;
                const activeEl = usedEvent && usedEvent.target ? usedEvent.target.closest('.nav-link') : null;
                if (activeEl) activeEl.classList.add('active');
            } catch (e) { /* ignore */ }


            if (window.innerWidth <= 991) {
                document.getElementById('sidebar').classList.remove('show');
            }
            

            if (section === 'pending') {
                loadPendingListings();
            } else if (section === 'listings') {
                filterListings('');
            } else if (section === 'users') {
                loadUsers();
            } else if (section === 'transactions') {
                loadTransactions();
            }
        }
        

        function loadDashboardStats() {

            const stats = {
                total_users: 145,
                listings: {
                    pending: 8,
                    approved: 42,
                    rejected: 3,
                    archived: 2
                }
            };
            
            document.getElementById('statUsers').textContent = stats.total_users;
            document.getElementById('statPending').textContent = stats.listings.pending;
            document.getElementById('statApproved').textContent = stats.listings.approved;
            document.getElementById('statRejected').textContent = stats.listings.rejected;
            document.getElementById('pendingCount').textContent = stats.listings.pending;
        }
        

        function loadPendingListings() {
            const container = document.getElementById('pendingListingsContainer');
            

            const pendingListings = [
                {
                    id: '101',
                    title: 'Kos Modern Strategis di Pusat Kota',
                    owner_name: 'Budi Santoso',
                    owner_email: 'budi@example.com',
                    category: 'kos-putra',
                    price: 1500000,
                    address: 'Jl. Sudirman No. 45, Kaliwates',
                    created_at: '2024-11-18 10:30:00',
                    image: 'https:
                }
            ];
            
            if (pendingListings.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-check-circle text-success fs-1 mb-3"></i>
                        <h5>Tidak Ada Listing Pending</h5>
                        <p class="text-muted">Semua listing sudah diproses</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = pendingListings.map(listing => `
                <div class="listing-card mb-3">
                    <div class="row g-0">
                        <div class="col-md-3">
                            <img src="${listing.image}" class="img-fluid rounded-start h-100 object-fit-cover" alt="${listing.title}">
                        </div>
                        <div class="col-md-9">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div>
                                        <h5 class="card-title mb-1">${listing.title} ${listingBadges[listing.id] ? (`<span class="badge bg-info ms-2 text-dark">${listingBadges[listing.id].badge.replace('_',' ')}</span>`) : ''}</h5>
                                        <p class="text-muted small mb-2">
                                            <i class="bi bi-person me-1"></i> ${listing.owner_name}
                                            <span class="mx-2">â€¢</span>
                                            <i class="bi bi-envelope me-1"></i> ${listing.owner_email}
                                        </p>
                                    </div>
                                    <span class="status-badge status-pending">
                                        <i class="bi bi-clock-history me-1"></i>
                                        Pending
                                    </span>
                                </div>
                                
                                <div class="row g-3 mb-3">
                                    <div class="col-md-6">
                                        <small class="text-muted d-block">Kategori</small>
                                        <span class="badge bg-light text-dark">${listing.category}</span>
                                    </div>
                                    <div class="col-md-6">
                                        <small class="text-muted d-block">Harga</small>
                                        <strong class="text-primary">Rp ${listing.price.toLocaleString('id-ID')}</strong>/bulan
                                        <div class="small text-muted mt-1">Fee admin: ${adminFeePercent}% ${listingFees[listing.id] ? `â€¢ Fee listing: Rp ${listingFees[listing.id].toLocaleString('id-ID')}` : ''}</div>
                                    </div>
                                </div>
                                
                                <p class="small text-muted mb-3">
                                    <i class="bi bi-geo-alt me-1"></i>
                                    ${listing.address}
                                </p>
                                
                                <div class="d-flex gap-2">
                                    <button class="btn btn-success btn-sm" onclick="showApprovalModal('${listing.id}')">
                                        <i class="bi bi-check-circle me-1"></i>
                                        Setujui
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="showRejectionModal('${listing.id}')">
                                        <i class="bi bi-x-circle me-1"></i>
                                        Tolak
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="showBadgeModal('${listing.id}')">
                                        <i class="bi bi-award me-1"></i>
                                        Tambah Badge
                                    </button>
                                    <button class="btn btn-outline-warning btn-sm" onclick="showFeeModal('${listing.id}')">
                                        <i class="bi bi-cash-stack me-1"></i>
                                        Set Fee
                                    </button>
                                    <a href="listing-detail.html?id=${listing.id}" class="btn btn-outline-primary btn-sm" target="_blank">
                                        <i class="bi bi-eye me-1"></i>
                                        Lihat Detail
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        

        function showApprovalModal(listingId) {
            currentListingId = listingId;
            approvalModal.show();
        }
        

        function showRejectionModal(listingId) {
            currentListingId = listingId;
            document.getElementById('rejectionReason').value = '';
            rejectionModal.show();
        }
        

        function confirmApprove() {
            if (!currentListingId) return;
            

            console.log('Approving listing:', currentListingId);
            
            notify.success('Listing berhasil disetujui!', 'Berhasil!');
            approvalModal.hide();
            
            setTimeout(() => {
                loadDashboardStats();
                loadPendingListings();
            }, 500);
        }
        

        function confirmReject() {
            const reason = document.getElementById('rejectionReason').value;
            
            if (!reason.trim()) {
                notify.warning('Mohon masukkan alasan penolakan', 'Alasan Diperlukan');
                return;
            }
            
            if (!currentListingId) return;
            

            console.log('Rejecting listing:', currentListingId, 'Reason:', reason);
            
            notify.success('Listing berhasil ditolak', 'Berhasil!');
            rejectionModal.hide();
            
            setTimeout(() => {
                loadDashboardStats();
                loadPendingListings();
            }, 500);
        }


        function showBadgeModal(listingId) {
            currentListingId = listingId;

            const b = listingBadges[listingId];
            document.getElementById('badgeSelect').value = b ? b.badge : '';
            document.getElementById('badgeHighlight').checked = b ? !!b.highlight : true;
            badgeModal.show();
        }

        function assignBadge() {
            const badge = document.getElementById('badgeSelect').value;
            const highlight = document.getElementById('badgeHighlight').checked;
            if (!badge) {
                notify.warning('Pilih badge dahulu', 'Tidak ada badge');
                return;
            }
            listingBadges[currentListingId] = { badge, highlight };
            notify.success('Badge disimpan untuk listing', 'Berhasil');
            badgeModal.hide();

            loadPendingListings();
            filterListings('');
        }


        function openFeeSettings() {
            currentListingId = null;
            document.getElementById('adminFeeInput').value = adminFeePercent;
            document.getElementById('listingFeeInput').value = '';
            feeModal.show();
        }

        function showFeeModal(listingId) {
            currentListingId = listingId;

            document.getElementById('listingFeeInput').value = listingFees[listingId] || '';
            document.getElementById('adminFeeInput').value = adminFeePercent;
            feeModal.show();
        }

        function saveFeeSettings() {
            const adminFee = parseFloat(document.getElementById('adminFeeInput').value || adminFeePercent);
            const listingFee = parseFloat(document.getElementById('listingFeeInput').value || 0);
            if (!isNaN(adminFee)) adminFeePercent = adminFee;

            if (currentListingId) {
                if (!isNaN(listingFee) && listingFee > 0) listingFees[currentListingId] = listingFee;
                notify.success('Fee listing disimpan', 'Berhasil');
            } else {
                notify.success('Fee admin disimpan', 'Berhasil');
            }
            feeModal.hide();

            loadPendingListings();
            loadTransactions();
        }


        function loadTransactions() {
            const tbody = document.getElementById('transactionsTableBody');
            const pendingCount = mockTransactions.filter(t => t.status === 'pending').length;
            document.getElementById('txnPendingCount').textContent = pendingCount;

            tbody.innerHTML = mockTransactions.map(txn => {
                const computedFee = txn.fee ? txn.fee : Math.round(txn.amount * adminFeePercent / 100);
                return `
                <tr>
                    <td>${txn.id}</td>
                    <td>${txn.renter}</td>
                    <td>${txn.owner}</td>
                    <td>${txn.listing}</td>
                    <td>Rp ${txn.amount.toLocaleString('id-ID')}</td>
                    <td>Rp ${computedFee.toLocaleString('id-ID')}</td>
                    <td><span class="badge bg-${txn.status === 'pending' ? 'warning' : txn.status === 'verified' ? 'success' : 'secondary'} text-dark">${txn.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="showTxnVerifyModal('${txn.id}')">Verifikasi</button>
                    </td>
                </tr>
            `; }).join('');
        }

        function showTxnVerifyModal(txnId) {
            currentTxnId = txnId;
            const txn = mockTransactions.find(t => t.id === txnId);
            if (!txn) return;
            document.getElementById('txnVerifyBody').textContent = `Transaksi ${txn.id} â€” ${txn.listing} (Rp ${txn.amount.toLocaleString('id-ID')})`;
            document.getElementById('txnStatusSelect').value = txn.status;
            txnVerifyModal.show();
        }

        function confirmVerifyTransaction() {
            if (!currentTxnId) return;
            const newStatus = document.getElementById('txnStatusSelect').value;
            const txn = mockTransactions.find(t => t.id === currentTxnId);
            if (!txn) return;
            txn.status = newStatus;
            notify.success('Status transaksi diperbarui', 'Berhasil');
            txnVerifyModal.hide();
            loadTransactions();
        }
        

        function filterListings(status) {
            const container = document.getElementById('allListingsContainer');
            container.innerHTML = '<p class="text-center py-5">Loading...</p>';


            setTimeout(() => {
                const all = [
                    { id: '101', title: 'Kos Modern Strategis di Pusat Kota', owner_name: 'Budi Santoso', category: 'kos-putra', price: 1500000, status: 'pending', image: 'https:
                    { id: '102', title: 'Apartemen Minimalis Dekat Kampus', owner_name: 'Ika H.', category: 'apartemen', price: 2200000, status: 'approved', image: 'https:
                ];

                const filtered = status ? all.filter(l => l.status === status) : all;

                if (filtered.length === 0) {
                    container.innerHTML = '<p class="text-muted">Tidak ada listing untuk filter tersebut</p>';
                    return;
                }

                container.innerHTML = filtered.map(listing => `
                    <div class="listing-card mb-3">
                        <div class="row g-0">
                            <div class="col-md-3">
                                <img src="${listing.image}" class="img-fluid rounded-start h-100 object-fit-cover" alt="${listing.title}">
                            </div>
                            <div class="col-md-9">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <div>
                                            <h5 class="card-title mb-1">${listing.title} ${listingBadges[listing.id] ? (`<span class="badge bg-info ms-2 text-dark">${listingBadges[listing.id].badge.replace('_',' ')}</span>`) : ''}</h5>
                                            <p class="text-muted small mb-2"><i class="bi bi-person me-1"></i> ${listing.owner_name}</p>
                                        </div>
                                        <span class="status-badge ${listing.status === 'pending' ? 'status-pending' : listing.status === 'approved' ? 'status-approved' : 'status-rejected'}">
                                            ${listing.status}
                                        </span>
                                    </div>

                                    <div class="row g-3 mb-3">
                                        <div class="col-md-6">
                                            <small class="text-muted d-block">Kategori</small>
                                            <span class="badge bg-light text-dark">${listing.category}</span>
                                        </div>
                                        <div class="col-md-6">
                                            <small class="text-muted d-block">Harga</small>
                                            <strong class="text-primary">Rp ${listing.price.toLocaleString('id-ID')}</strong>/bulan
                                        </div>
                                    </div>

                                    <div class="d-flex gap-2">
                                        <button class="btn btn-outline-secondary btn-sm" onclick="showBadgeModal('${listing.id}')">Badge</button>
                                        <button class="btn btn-outline-warning btn-sm" onclick="showFeeModal('${listing.id}')">Set Fee</button>
                                        <a href="listing-detail.html?id=${listing.id}" class="btn btn-outline-primary btn-sm">Lihat</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }, 500);
        }
        

        function loadUsers() {
            const tbody = document.getElementById('usersTableBody');
            

            const users = [
                {
                    id: '1',
                    name: 'John Doe',
                    email: 'john@example.com',
                    role: 'user',
                    verified: 1,
                    created_at: '2024-01-15'
                },
                {
                    id: '2',
                    name: 'Jane Smith',
                    email: 'jane@example.com',
                    role: 'host',
                    verified: 0,
                    created_at: '2024-02-20'
                }
            ];
            
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td><span class="badge bg-${user.role === 'host' ? 'primary' : 'secondary'}">${user.role}</span></td>
                    <td>
                        ${user.verified 
                            ? '<span class="badge bg-success">Terverifikasi</span>' 
                            : '<span class="badge bg-warning">Belum Verifikasi</span>'}
                    </td>
                    <td>${new Date(user.created_at).toLocaleDateString('id-ID')}</td>
                    <td>
                        ${!user.verified 
                            ? `<button class="btn btn-sm btn-success" onclick="verifyUser('${user.id}')">Verifikasi</button>`
                            : '<small class="text-muted">-</small>'}
                    </td>
                </tr>
            `).join('');
        }
        

        function verifyUser(userId) {
            if (confirm('Verifikasi user ini?')) {
                notify.success('User berhasil diverifikasi', 'Berhasil!');
                loadUsers();
            }
        }
        
        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>